{% set component_map =
{
  'Android':['Java-Android', 'Kotlin', 'Kotlin-Android', 'LiteCore'],
  'C':['C', 'LiteCore'],
  '.NET':['.NET', 'LiteCore'],
  'Java':['Java', 'Java-Android', 'Kotlin-Android'],
  'Javascript':['Kotlin', 'LiteCore'],
  'Objective-C':['IOS', 'LiteCore'],
  'Swift':['IOS', 'LiteCore']
} -%}

{% set filtered_issues = issues | filter_by_component(component_map[user_settings.fields['module']]) %}

{% set bugs = filtered_issues | selectattr('fields.issuetype.name', 'in', 'Bug')
| selectattr('fields.status.name', 'in','Resolved, Closed')
| selectattr('fields.resolution.name', 'in','Fixed, Done')
| rejectattr('fields.labels', 'contains', 'known_issue') | list  %}

{% set improvements = filtered_issues | selectattr('fields.issuetype.name', 'in', 'Improvement')
| selectattr('fields.status.name', 'in','Resolved, Closed')
| selectattr('fields.resolution.name', 'in','Fixed, Done')
| rejectattr('fields.labels', 'contains', 'known_issue') | list %}

{% set known_issues = filtered_issues | selectattr('fields.labels', 'contains', 'known_issue')
| rejectattr('fields.status.name', 'in','Resolved, Closed') | list %}

// tag::issues-{{ user_settings.fields.release_number | replace_dots('-') }}[]

== Fixed

// tag::Fixed-{{ user_settings.fields.release_number | replace_dots('-') }}[]

{% if bugs | length %}

{% for issue in bugs %}

* {{ user_settings.release_set.url }}/browse/{{ issue.key }}[++{{ issue.key }} — {{ issue.fields.summary }}++]

{% endfor %}

{% else %}

None for this release.

{%  endif %}

// end::Fixed-{{ user_settings.fields.release_number | replace_dots('-') }}[]

== Enhancements

// tag::Enhancements-{{ user_settings.fields.release_number | replace_dots('-') }}[]

{% if improvements | length %}

{% for issue in improvements %}

* {{ user_settings.release_set.url }}/browse/{{ issue.key }}[++{{ issue.key }} — {{ issue.fields.summary }}++]

{% endfor %}

{%  else %}

None for this release.

{% endif %}

// end::Enhancements-{{ user_settings.fields.release_number | replace_dots('-') }}[]

== Known Issues

// tag::KI-{{ user_settings.fields.release_number | replace_dots('-') }}[]

{% if known_issues | length %}


{% for issue in known_issues %}

* {{ user_settings.release_set.url }}/browse/{{ issue.key }}[++{{ issue.key }} — {{ issue.fields.summary }}++]

{% endfor %}

{%  else %}

None for this release.

{% endif %}

// end::KI-{{ user_settings.fields.release_number | replace_dots('-') }}[]

// end::issues-{{ user_settings.fields.release_number | replace_dots('-') }}[]

